<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" type="image/png" href="static/favicon-16x16.png" sizes="16x16" />
  <link rel="stylesheet" href="css/style.css" />
  <title>Gray Area Festival Video Archive</title>
  <!-- <script defer src="lib/alpine.persist.min.js"></script> -->
  <script defer src="lib/alpine.min.js"></script>
  <script src="js/main.js"></script>
</head>

<body>
  <div x-data="videoData">
    <div x-data="filters">
      <header>
        <div id="logo">
          <img src="static/gray-area-logo-text-small.svg" alt="Gray Area" />
        </div>
        <h2>Festival Video Archive</h2>
      </header>

      <template x-if="selVideo">
        <div id="videoViewer" x-data="selVideo">
          <button x-on:click="selVideo = false">Close</button>

          <div class="videoPlayer">
            <iframe class="ytvideo" :src="('https://www.youtube.com/embed/' + selVideo.display_id)"
              title="YouTube video player" frameborder="0"
              allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture;" allowfullscreen>
            </iframe>
          </div>

          <div x-data="{ open: false }">
            <h3>
              <a href="#;" x-on:click="open = !open" x-text="'Captions ' + (open ? '▾' : '▸')"></a>
            </h3>
            <template x-if="open">
              <pre class="transcript" x-text="selVideo.parsedSubs"></pre>
            </template>
          </div>

          <div x-data="{ open: false }">
            <h3>
              <a href="#;" x-on:click="open = !open" x-text="'Metadata ' + (open ? '▾' : '▸')"></a>
            </h3>
            <template x-if="open">
              <ul>
                <template x-for="v, i in selVideo">
                  <template x-if="i != 'parsedSubs'">
                    <li>
                      <span x-text="i"></span>
                      <template x-if="String(v).startsWith('http')">
                        <a :href="v" target="_blank" x-text="v"></a>
                      </template>
                      <template x-if="!String(v).startsWith('http')">
                        <span x-html="String(v).replace(/\n/g, '<br />')"></span>
                      </template>
                    </li>
                  </template>
                </template>
              </ul>
            </template>
          </div>
        </div>
      </template>

      <div id="filters">

        <h4>Filters</h4>

        <div class="filterFlexContainer">

          <div class="filterColumn" id="filterYear">
            <h5>FESTIVAL YEAR</h5>
            <ul x-data="filtersYear" x-on:change="filter(filtersYear)">
              <template x-for="f in filterYearStrings">
                <li>
                  <label><input type="checkbox" x-model="filtersYear" :value="f" /><span x-text="f"></span></label>
                </li>
              </template>
            </ul>
          </div>

          <div class="filterColumn" id="filterSortBy">
            <h5>SORT BY</h5>
            <ul x-data="filtersSortBy" x-on:change="filterSortBy(filtersSortBy);">
              <template x-for="f in filterSortByStrings">
                <li>
                  <label>
                    <input type="radio" x-model="filtersSortBy" :value="f" x-on:click="filterSortByRadioClick" />
                    <span x-text="f"></span>
                  </label>
                </li>
              </template>
            </ul>
          </div>

        </div>

      </div>



      <table id="videoTable">
        <tbody>
          <template x-if="!videos">
            <tr>
              <td colspan="2">Loading...</td>
            </tr>
          </template>
          <template x-for="video in pagedVideos">
            <tr>
              <td class="video">
                <div class="thumbnail">
                  <a href="#" x-on:click="selVideo = video; fetchSubs(selVideo)">
                    <img :src="video.thumbnail_small" />
                  </a>
                </div>
                <div class="info">
                  <a href="#" x-on:click="selVideo = video" x-text="video.title"></a>
                  <div class="date" x-text="video.festival_year"></div>
                </div>
              </td>
            </tr>
          </template>
        </tbody>
      </table>

      <div id="pagination">
        <button @click="previousPage">Previous Page</button>
        <button @click="nextPage">Next Page</button>
        <span>Page:</span> <span x-text="curPage"></span>
        of
        <span x-text="Math.ceil(videos.length / pageSize)"></span>
      </div>
    </div>
  </div>
</body>

</html>