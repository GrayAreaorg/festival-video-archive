<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      rel="icon"
      type="image/png"
      href="static/favicon-16x16.png"
      sizes="16x16"
    />
    <link rel="stylesheet" href="dist/output.css" />
    <title>Gray Area Festival Video Archive</title>
    <!-- <script defer src="lib/alpine.persist.min.js"></script> -->
    <script defer src="lib/alpine.min.js"></script>
    <script src="js/main.js"></script>
  </head>

  <body class="m-10 bg-zinc-800 text-slate-200">
    <div x-data="videoData">
      <div x-data="filters">

        <header>
          <a href="index.html">
            <img
              src="static/gray-area-logo-text-small.svg"
              alt="Gray Area"
              class="max-w-xs mb-4"
            />
          </a>
          <h2 class="text-xl mb-4">Festival Video Archive</h2>
        </header>

        <template x-if="selVideo">
          <div x-data="selVideo" class="bg-zinc-900 p-5 my-5">
            <button class="bg-zinc-600 mb-5 hover:bg-slate-700 p-1 px-4 rounded-full" x-on:click="selVideo = false">Close</button>

            <div class="videoPlayer">
              <iframe
                class="ytvideo"
                :src="('https://www.youtube.com/embed/' + selVideo.display_id)"
                title="YouTube video player"
                frameborder="0"
                allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture;"
                allowfullscreen
              >
              </iframe>
            </div>

            <div x-data="{ open: false }" class="py-5">
              <h3>
                <a
                  href="#;"
                  x-on:click="open = !open"
                  x-text="'Captions ' + (open ? '▾' : '▸')"
                ></a>
              </h3>
              <template x-if="open">
                <pre class="p-2 bg-zinc-950 overflow-auto w-full h-64" x-text="selVideo.parsedSubs"></pre>
              </template>
            </div>

            <div x-data="{ open: false }" class="py-5">
              <h3>
                <a
                  href="#;"
                  x-on:click="open = !open"
                  x-text="'Metadata ' + (open ? '▾' : '▸')"
                ></a>
              </h3>
              <template x-if="open">
                <ul class="m-2">
                  <template x-for="v, i in selVideo">
                    <template x-if="i != 'parsedSubs'">
                      <li class="text-sm">
                        <span x-text="i" class="text-slate-500 mr-2"></span>
                        <template x-if="String(v).startsWith('http')">
                          <a :href="v" target="_blank" x-text="v"></a>
                        </template>
                        <template x-if="!String(v).startsWith('http')">
                          <span
                            x-html="String(v).replace(/\n/g, '<br />')"
                          ></span>
                        </template>
                      </li>
                    </template>
                  </template>
                </ul>
              </template>
            </div>
          </div>
        </template>

        <!-- filters -->
        <div id="filters" class="bg-zinc-900 p-5">
          <h4 class="text-xs">FILTERS</h4>

          <div class="flex mt-4">

          <div id="filterYear" class="mr-5">
            <h5 class="text-xs border-b mb-2">YEAR</h5>
            <ul  x-data="filtersYear" x-on:change="filter(filtersYear)">
              <template x-for="f in filterYearStrings">
                <li class="text-zinc-600">
                  <label
                    ><input
                      type="checkbox"
                      x-model="filtersYear"
                      :value="f" /><span x-text="f"></span
                  ></label>
                </li>
              </template>
            </ul>
          </div>

          <div id="filterSortBy" class="mr-5">
            <h5 class="text-xs  border-b mb-2">SORT BY</h5>
            <ul
              x-data="filtersSortBy"
              x-on:change="filterSortBy(filtersSortBy);"
            >
              <template x-for="f in filterSortByStrings">
                <li>
                  <label>
                    <input type="radio" x-model="filtersSortBy" :value="f" />
                    <span x-text="f"></span>
                  </label>
                </li>
              </template>
            </ul>
          </div>

          <div id="filterTopic" class="mr-5">
            <h5 class="text-xs border-b mb-2">TOPICS</h5>
            <ul x-data="filtersTopic" x-on:change="filterTopic(filtersTopic);">
              <template x-for="f in filtersTopicStrings">
                <li>
                  <label>
                    <input type="checkbox" x-model="filtersTopic" :value="f" />
                    <span x-text="f"></span>
                  </label>
                </li>
              </template>
            </ul>
          </div>

        </div>

        </div>

        <!-- results -->
        <div class="flex-auto max-w-full my-4" >
          <template x-if="!videos">
            <span>Loading...</span>
          </template>
          <template x-for="video in pagedVideos">
            <div class="bg-zinc-900 p-5 inline-block mr-4 mb-4 w-95 h-64 align-top">
              <a href="#" x-on:click="selVideo = video; fetchSubs(selVideo)">
                <img :src="video.thumbnail_small" class="w-full" />
                <h3 x-text="video.title" class="w-60"></h3>
              </a>
            </div>
          </template>
        </div>

        <div class="mt-5">
          <button class="bg-zinc-600 hover:bg-slate-700 p-1 px-4 rounded-full" @click="previousPage">Previous Page</button>
          <button class="ml-1 bg-zinc-600 hover:bg-slate-700 p-1 px-4 rounded-full" @click="nextPage">Next Page</button>
          <div class="inline-block ml-4">
            <span>Page:</span> <span x-text="curPage"></span>
            of
            <span x-text="Math.ceil(videos.length / pageSize)"></span>
          </div>
        </div>

    </div>
  </body>
</html>
